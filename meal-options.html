<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Bowl — Select Meals</title>

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">

    <style>

        .meal-card {
    cursor: pointer;
    border: 2px solid transparent;
    transition: 0.2s ease;
    position: relative;
}

.meal-card.selected {
    border: 2px solid #4CAF50;
    box-shadow: 0 8px 22px rgba(0,0,0,0.12);
    transform: translateY(-4px);
}

.select-btn {
    margin-top: auto;
    padding: 10px 14px;
    border-radius: 10px;
    border: 2px solid #4CAF50;
    background: white;
    color: #4CAF50;
    font-weight: 700;
    cursor: pointer;
    text-align: center;
    transition: 0.2s;
}

.meal-card.selected .select-btn {
    background: #4CAF50;
    color: white;
}
        .page-title {
            padding: 28px 40px 0;
            max-width: 1200px;
            margin: 0 auto;
        }
        .small-title {
            font-size: 22px;
            font-weight: 600;
            color: #0b5130;
            margin-bottom: 10px;
        }

        .meal-list {
            display: flex;
            flex-wrap: wrap;
            gap: 28px;
            padding: 32px 40px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .meal-card {
            width: 300px;
            background: #fff;
            border-radius: 14px;
            overflow: hidden;
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
            transition: transform .14s;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        .meal-card:hover { transform: translateY(-6px); }

        .meal-card img {
            width: 100%;
            height: 180px;
            object-fit: cover;
        }

        .meal-body {
            padding: 14px;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .meal-body h3 {
            margin: 0;
            color: #0b5130;
            font-size: 18px;
            font-weight: 700;
        }

        .meal-body p {
            margin: 0;
            color: #666;
            font-size: 14px;
        }

        .checkbox-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 6px;
        }

        .summary-box {
            max-width: 1200px;
            margin: 0 auto 40px;
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .price-tag {
            font-size: 20px;
            font-weight: 700;
            color: #0b5130;
        }

        .proceed-btn {
            padding: 12px 22px;
            background: #4CAF50;
            color: white;
            font-size: 16px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 700;
        }

        @media (max-width:900px){
          .meal-list { padding:20px; justify-content:center; }
          .meal-card { width:92%; }
          .summary-box { padding:20px; flex-direction:column; gap:20px; }
        }
    </style>
</head>
<body>

<!-- HEADER -->
<header class="header" style="background:#4CAF50;color:white;">
    <div class="header-left">
        <img src="https://img.icons8.com/color/48/ffffff/salad.png" class="logo-icon">
        <span class="logo-text">Bowl</span>
    </div>

    <nav class="header-nav">
        <a href="index.html" style="color:white">Home</a>
        <a href="#partner">Become Partner</a>
        <a href="#about-us" style="color:white">About Us</a>
        <button class="signin-btn">Sign In</button>
    </nav>
</header>

<!-- PAGE TITLE -->
<section class="page-title">
    <h2 class="small-title">Select your meals</h2>
    <p style="color:#555; font-size:14px;">Pick one or more meals to create your subscription</p>
</section>

<!-- MEAL LIST -->
<section id="mealList" class="meal-list">
    <p style="color:#666; padding:28px;">Loading meals…</p>
</section>

<!-- PRICE SUMMARY -->
<section class="summary-box">
    <div class="price-tag" id="priceTag">
        Total: ₹0 / month
    </div>

    <button class="proceed-btn" onclick="goNext()">Proceed</button>
</section>

<!-- FOOTER -->
<footer class="footer">
    <p>© 2025 Bowl Health — All Rights Reserved</p>
</footer>
<script>
    (function(){

        const SHEET_ID = "1w1xw3igo03UEw159KDTXPUgLg1Pg9dNKRDDl3ZdxmuM";
        const URL_MEALS = `https://opensheet.elk.sh/${SHEET_ID}/meals`;

        let meals = [];
        let selected = new Set();

        function normalize(rows){
          return rows.map(r=>{
            const o={};
            Object.keys(r).forEach(k=>o[k.trim()] = (r[k]||"").trim());
            return o;
          });
        }

        async function loadMeals(){
          const res = await fetch(URL_MEALS);
          meals = normalize(await res.json());

          meals.forEach(m=>{
            m.kitchen_id = String(m.kitchen_id);
            m.plan_id = String(m.plan_id);
            m.price = Number(m.price || 0);
          });

          render();
        }

        function render(){
          const kid = localStorage.getItem("kitchenId");
          const pid = localStorage.getItem("planId");
          const box = document.getElementById("mealList");

          const list = meals.filter(m => m.kitchen_id === kid && m.plan_id === pid);

          box.innerHTML = "";

          list.forEach(meal => {
            const img = meal.image_url || "https://via.placeholder.com/400x250?text=Meal";

            box.innerHTML += `
              <div class="meal-card" data-id="${meal.meal_id}" data-price="${meal.price}">
                <img src="${img}">
                <div class="meal-body">
                  <h3>${meal.meal_name}</h3>
                  <p>${meal.meal_type} • ₹${meal.price} / day</p>
                  <div class="select-btn">Select</div>
                </div>
              </div>
            `;
          });

          attachEvents();
          updatePrice();
        }

        function attachEvents(){
          document.querySelectorAll(".meal-card").forEach(card => {
            card.addEventListener("click", () => toggleSelection(card));
          });
        }

        function toggleSelection(card){
          const id = card.dataset.id;
          const price = Number(card.dataset.price);

          if(selected.has(id)){
            selected.delete(id);
            card.classList.remove("selected");
            card.querySelector(".select-btn").innerHTML = "Select";
          } else {
            selected.add(id);
            card.classList.add("selected");
            card.querySelector(".select-btn").innerHTML = "Selected ✓";
          }

          updatePrice();
        }

        function updatePrice(){
          let perDay = 0;

          selected.forEach(id => {
            const meal = meals.find(m => m.meal_id === id);
            if(meal) perDay += meal.price;
          });

          const monthly = perDay * 30;

          document.getElementById("priceTag").innerHTML =
            `Total: ₹${monthly} / month`;

          localStorage.setItem("selected_meals_ids", JSON.stringify([...selected]));
          localStorage.setItem("per_day_price", perDay);
          localStorage.setItem("monthly_price", monthly);
        }

        window.goNext = function(){
          if(selected.size === 0){
            alert("Select at least one meal");
            return;
          }
          window.location.href = "subscribe.html";
        };

        loadMeals();

    })();
</script>
</body>
</html>